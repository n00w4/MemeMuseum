<header class="app-header">
  <div class="logo-container">
    <h1 class="logo">MEMEMUSEUM</h1>
    <p class="tagline">Explore, Share, Laugh</p>
  </div>

  <!-- search-bar -->
  <div class="search-container">
    <form [formGroup]="searchForm" (ngSubmit)="applyFilters()">
      <div class="search-group">
        <input
          type="text"
          formControlName="tags"
          placeholder="Search memes by tags..."
          list="tag-suggestions"
        />
        <datalist id="tag-suggestions">
          @for (tag of tags(); track tag) {
          <option [value]="tag">{{ tag }}</option>
          }
        </datalist>
        <button type="submit" class="search-btn">
          <svg viewBox="0 0 24 24">
            <path
              d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
            />
          </svg>
        </button>
      </div>
    </form>
  </div>

  <div class="header-controls">
    <button class="toggle-filters-btn" (click)="toggleAdvancedFilters()">
      {{ showAdvancedFilters() ? "Hide Filters" : "Show Filters" }}
    </button>

    @if (!isLoggedIn()) {
    <div class="auth-actions">
      <a routerLink="/login" class="auth-btn">Login</a>
      <a routerLink="/register" class="auth-btn accent">Register</a>
    </div>
    } @else {
    <div class="user-actions">
      <a routerLink="/upload" class="upload-btn">
        <svg class="icon-upload" viewBox="0 0 24 24" width="20" height="20">
          <path d="M9 16h6v-6h4l-7-7-7 7h4v6zm-4 2h14v2H5v-2z" />
        </svg>
        Upload
      </a>
      <a routerLink="/profile" class="user-avatar">
        <svg class="icon-user" viewBox="0 0 24 24" width="20" height="20">
          <path
            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
          />
        </svg>
      </a>
    </div>
    }
  </div>
</header>

<main class="content-container">
  @if (showAdvancedFilters()) {
  <section class="filters-section" [formGroup]="advancedFiltersForm">
    <form [formGroup]="advancedFiltersForm">
      <div class="filter-group" formGroupName="dateRange">
        <div>
          <span id="date-range-label">Date Range:</span>
        </div>
        <div class="date-range" aria-labelledby="date-range-label">
          <div>
            <label for="dateRangeStart">Start date</label>
            <input id="dateRangeStart" type="date" formControlName="start" />
          </div>
          <div>
            <label for="dateRangeEnd">End date</label>
            <input id="dateRangeEnd" type="date" formControlName="end" />
          </div>
        </div>
      </div>

      <div class="filter-group">
        <label for="sortBy">Sort By:</label>
        <select id="sortBy" formControlName="sortBy">
          <option value="ratingDesc">Highest Rated</option>
          <option value="ratingAsc">Lowest Rated</option>
          <option value="dateDesc">Newest First</option>
          <option value="dateAsc">Oldest First</option>
        </select>
      </div>

      <div class="filter-actions">
        <button type="button" class="apply-btn" (click)="applyFilters()">
          Apply Filters
        </button>
        <button type="button" class="reset-btn" (click)="resetFilters()">
          Reset
        </button>
      </div>
    </form>
  </section>
  }

  <section class="memes-section">
    @if (isLoading()) {
    <div class="loading-indicator">
      <div class="spinner"></div>
      <p>Loading memes...</p>
    </div>
    } @else { @if (memes(); as memeList) { @if (memeList.length > 0) {
    <div class="meme-grid">
      @for (meme of memeList; track meme.id) {
      <app-meme-card [meme]="meme" [isLoggedIn]="isLoggedIn()"></app-meme-card>
      }
    </div>

    @if (totalPages() > 1) {
    <div class="pagination">
      <button
        class="pagination-btn"
        [disabled]="currentPage() === 1"
        (click)="goToPage(currentPage() - 1)"
      >
        &laquo; Prev
      </button>

      @for (page of pageNumbers(); track page) { @if (page === -1) {
      <span class="pagination-ellipsis">...</span>
      } @else {
      <button
        class="pagination-btn"
        [class.active]="page === currentPage()"
        (click)="goToPage(page)"
      >
        {{ page }}
      </button>
      } }

      <button
        class="pagination-btn"
        [disabled]="currentPage() === totalPages()"
        (click)="goToPage(currentPage() + 1)"
      >
        Next &raquo;
      </button>
    </div>
    } } @else {
    <div class="empty-state">
      <div class="empty-icon">üñºÔ∏è</div>
      <h3>No memes found</h3>
      <p>Try adjusting your filters or upload a new meme!</p>
    </div>
    } } @else {
    <div class="empty-state">
      <div class="empty-icon">‚ö†Ô∏è</div>
      <h3>Oops! Something went wrong.</h3>
      <p>We couldn't load the memes. Please try again later.</p>
    </div>
    }}
  </section>
</main>

<footer class="app-footer">
  <div class="footer-content">
    <p>¬© 2025 MEMEMUSEUM | Internet Culture Preservation</p>
    <nav>
      <a href="#">About</a>
      <a href="#">Guidelines</a>
      <a href="#">API</a>
      <a routerLink="/meme-del-giorno">Meme del Giorno</a>
    </nav>
  </div>
</footer>
