<div class="upload-container">
  <div class="upload-card">
    <h2>Upload New Meme</h2>

    <form [formGroup]="uploadForm" (ngSubmit)="onSubmit()" class="upload-form">
      <div class="form-group">
        <label for="title">Title *</label>
        <input
          id="title"
          type="text"
          formControlName="title"
          placeholder="Enter meme title"
          [maxlength]="100"
          class="form-control"
          [class.error]="
            uploadForm.get('title')?.invalid && uploadForm.get('title')?.touched
          "
        />

        <div class="char-counter">
          {{ uploadForm.get("title")?.value?.length || 0 }}/100
        </div>

        @if (uploadForm.get('title')?.invalid &&
        uploadForm.get('title')?.touched) {
        <div class="error-message">
          @if (uploadForm.get('title')?.errors?.['required']) {
          <span>Title is required</span>
          } @if (uploadForm.get('title')?.errors?.['maxlength']) {
          <span>Title must be less than 100 characters</span>
          }
        </div>
        }
      </div>

      <div class="form-group">
        <label for="tags">Tags (optional)</label>
        <input
          id="tags"
          type="text"
          formControlName="tags"
          placeholder="Enter tags separated by commas (e.g., funny, cat, lol)"
          class="form-control"
        />
        <div class="help-text">Separate tags with commas</div>
      </div>

      <div class="form-group">
        <label for="imageInput">Image * (Max 5MB)</label>
        <div class="file-upload-area">
          <input
            id="imageInput"
            type="file"
            accept="image/jpeg,image/png,image/gif,image/webp"
            (change)="onFileSelected($event)"
            class="file-input"
          />

          <div
            class="file-upload-label"
            [class.error]="
              uploadForm.get('image')?.invalid &&
              uploadForm.get('image')?.touched
            "
          >
            <span>Choose an image file</span>
            <span class="browse-btn">Browse</span>
          </div>
        </div>

        @if (uploadForm.get('image')?.invalid &&
        uploadForm.get('image')?.touched) {
        <div class="error-message">Image is required</div>
        }
      </div>

      @if (imagePreview) {
      <div class="image-preview">
        <h4>Preview:</h4>
        <img [src]="imagePreview" alt="Meme preview" class="preview-image" />
      </div>
      }

      <div class="feedback-messages">
        @if (uploadError()) {
        <div class="error-message">
          {{ uploadError() }}
        </div>
        } @if (uploadSuccess()) {
        <div class="success-message">
          {{ uploadSuccess() }}
        </div>
        }
      </div>

      <div class="form-actions">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="onCancel()"
          [disabled]="isUploading()"
        >
          Cancel
        </button>

        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="uploadForm.invalid || !selectedFile || isUploading()"
        >
          @if (!isUploading()) {
          <span>Upload Meme</span>
          } @if (isUploading()) {
          <span>Uploading...</span>
          }
        </button>
      </div>
    </form>
  </div>
</div>
